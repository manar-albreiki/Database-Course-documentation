USE bank
select * from Branch
-- 1. Display branch ID, name, and the name of the employee who manages it. 
select
b.branch_ID,
e.employee_name,
e.employee_position
from Branch b
join Employee e
on e.branch_ID = b.branch_ID
where e.employee_position = 'Manager'

-- 2. Display branch names and the accounts opened under each. 
SELECT 
    B.address AS Branch_Name,
    A.account_ID
FROM Branch B
JOIN Employee E
    ON B.branch_ID = E.branch_ID
JOIN Customer_Employee CE
    ON E.employee_ID = CE.employee_ID
JOIN Account A
    ON CE.customer_ID = A.customer_ID
ORDER BY B.address;

-- 3. Display full customer details along with their loans. 


SELECT 
    C.customer_ID, C.C_name, C.C_phone, C.date_of_birth, C.address,
    L.loans_ID, L.loans_type, L.Loans_amount, L.issue_date
FROM Customer C
 left JOIN Loans L
    ON C.customer_ID = L.customer_ID

-- 4. Display loan records where the loan office is in 'Alexandria' or 'Giza'. 
select 
L.*, B.address
FROM Loans L
JOIN Employee E
ON E.employee_ID = L.employee_ID
JOIN Branch B
ON B.branch_ID = E.branch_ID
WHERE B.address like '%Sohar%'
or B.address like '%Muscat%'


-- 5. Display account data where the type starts with "S" (e.g., "Savings"). 
SELECT * FROM Account
WHERE account_type like '%S%'

-- 6. List customers with accounts having balances between 20,000 and 50,000. 
select
c.C_name,
a.account_balance
from Customer c
join Account a
on c.customer_ID = a.customer_ID
where a.account_balance between 20000 and 50000

-- 7. Retrieve customer names who borrowed more than 100,000 LE from 'Cairo Main Branch'. 
SELECT 
    C.C_name, L.Loans_amount
FROM Customer C
JOIN Loans L
    ON C.customer_ID = L.customer_ID
JOIN Employee E
    ON L.employee_ID = E.employee_ID
JOIN Branch B
    ON E.branch_ID = B.branch_ID
WHERE L.Loans_amount > 10000
  AND B.address like '%Muscat%'

-- 8. Find all customers assisted by employee "Amira Khaled". 
select * from Customer
select * from Employee
select 
c.C_name, e.employee_name
from Customer c
join Customer_Employee ce
on c.customer_ID = ce.customer_ID
join Employee e
on e.employee_ID = ce.employee_ID
where e.employee_name = 'Noor Al-Balushi'

-- 9. Display each customerâ€™s name and the accounts they hold, sorted by account type. 

SELECT 
    C.C_name,
    A.account_ID,
    CASE
        WHEN A.savings > 0 THEN 'Savings'
        WHEN A.checking > 0 THEN 'Checking'
        ELSE 'Unknown'
    END AS Account_Type
FROM Customer C
JOIN Account A
    ON C.customer_ID = A.customer_ID
ORDER BY Account_Type

-- 10. For each loan issued in Cairo, show loan ID, customer name, employee handling it, and branch name. 
SELECT 
    L.loans_ID,
    C.C_name AS Customer_Name,
    E.employee_name AS Employee_Name,
    B.address AS Branch_Name
FROM Loans L
JOIN Customer C
    ON L.customer_ID = C.customer_ID
JOIN Employee E
    ON L.employee_ID = E.employee_ID
JOIN Branch B
    ON E.branch_ID = B.branch_ID
WHERE B.address LIKE '%Muscat%'

-- 11. Display all employees who manage any branch. 
SELECT *
FROM Employee
WHERE employee_position = 'Manager'

-- 12. Display all customers and their transactions, even if some customers have no transactions yet. 
SELECT 
    C.customer_ID,
    C.C_name,
    C.C_phone,
    A.account_ID,
    T.transaction_ID,
    T.transaction_date,
    T.withdrawals,
    T.deposits,
    T.transfers,
    T.balance
FROM Customer C
LEFT JOIN Account A
    ON C.customer_ID = A.customer_ID
LEFT JOIN Transactions T
    ON A.account_ID = T.account_ID